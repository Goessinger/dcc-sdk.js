const {sign, verify, pack, unpack, signAndPack, unpackAndVerify, signAndPack32, signAndPack45, makeCWT, parseCWT, debug} = require('../lib/index');

test('Verify IS_2DCode_raw_1', async () => {
  const HC1 = 'HC1:NCFOXN%TSMAHN-HPVSPWKW$5C F.SN0II2D0 43BT7/EBXF2U4G7WCGJ9CANAMQQHIZC4.OI1RM8ZA*LPULVO.G63KHUVE/9*/GB2P4TPYE9/MVH:S.A5:S9395*CBVZ0K1H%Y0BZIGDB5LKPMIHZISVBX3C*8BEPLA8KOHSLOJJPA*709EF7AL-T4P*KQYGN%2+T4D-4HRVUMNMD3323R13A2VC-4A+2XEN QT QTHC31M3+E3CP456L X4CZKHKB-43.E3KD3OAJ5%IWZKRA38M7323Q05.$S580QW6:CGPOJI7JSTNB95V/5HFKKKUG%M/PKDVS7%NC.U+NG WUJUHIO2 .1/7AI596AL**IOS0VPVI97I97M%V9Y4KCT1+S-8FB%0XKR.RNPCGZUIQJAZGA2:UG%U2E4P1OIW1FTJ297H%OFXJ3 RZI1  G48GZUCV7LNZK26JYJS5MIJYTYLHD26$T9XG5+3MRVQGUCUUH6YQ1AQT38 P6PNH9OABY3T+A40AE00INTN4';
  const cwtPayload = await unpackAndVerify(HC1);
  expect(cwtPayload).not.toBe(null);
  expect(cwtPayload).not.toBe(undefined);
  expect(await parseCWT(cwtPayload)).toStrictEqual({'dob': '2000-01-01', 'nam': {'fn': 'Prófarason', 'fnt': 'PROFARASON', 'gn': 'Þarf Að Prófa', 'gnt': 'THARF<AD<PROFA'}, 'v': [{'ci': '01 IS/ABC1234#K', 'co': 'IS', 'dn': 2, 'dt': '2021-01-01', 'is': 'Directorate of Health of Iceland Test', 'ma': 'ORG-100030215', 'mp': 'EU/1/20/1528', 'sd': 2, 'tg': '840539006', 'vp': 'J07BX03'}], 'ver': '1.0.0'});
});

test('Verify IS_2DCode_raw_2', async () => {
  const HC1 = 'HC1:NCFV A0086OBWS3*IF%1DU315VSH78MZ1Y3SBCV/ZA+A9-N8HNJO OLDD4T22+5/9TF5JV0O+QAU$9J-D2/R91ND5AZZM0I9:45Y03/I7WWI4ZES*QB9A*47AA3P*1T3ODOVG38S1E6LSZ4DC7FT*P.4W-2P18TJQIE.982U.EK$O73AVMPK75GS:LK6UFTPPIF-YMA+T+43D 0Z/6.$9P/N0Y4ECTLS9-:DH77RIBGGKK*9B06%A92CS$-48V6SF5W2PCVK+OQ2*1%GAS3M0KNMKG*9BY%9-/2:TT8NBUC61+4%QSIE459T3KJGCW-EOPOIJKCEJB8C1NDRX LOJBQNLEMPMGC:25J1U::2EQO9L8  AQA83.4HVUGMA LV8ZLPOVL6C4C4Y40BJ13/78D95JUCHC.VA-U9*4U*6T3.68$LNZA8186K3%Y0S+6U 8CHILT6OVNOVV70E9%NXC8Z UYTBJ1CV5JB.O0%3*FLTZ2/MG*/Q1HF4*O4$GS67XPIT.FXXVOQRUKV IF%OT.-C-Q7A:V ME+:JYEV$R3$0WIH062E%7O5+NN%RFGA45I6QF*LBEPC%WOVRPCQE2LP9-8G3O02WM-F3GVWZP0-I';
  const cwtPayload = await unpackAndVerify(HC1);
  expect(cwtPayload).not.toBe(null);
  expect(cwtPayload).not.toBe(undefined);
  expect(await parseCWT(cwtPayload)).toStrictEqual({'dob': '2000-01-01', 'nam': {'fn': 'Mjöggottson', 'fnt': 'MJOEGGOTTSON', 'gn': 'Ekki Vírus', 'gnt': 'EKKI<VIRUS'}, 't': [{'ci': '01 IS/ABC4556#8', 'co': 'IS', 'dr': '2021-05-14T17:46:45Z', 'is': 'Directorate of Health of Iceland Test', 'ma': '1304', 'sc': '2021-05-14T13:46:45Z', 'tc': 'Department of ClinicalMicrobiology,Landspitali', 'tg': '840539006', 'tr': '260415000', 'tt': 'LP6464-4'}], 'ver': '1.0.0'});
});

