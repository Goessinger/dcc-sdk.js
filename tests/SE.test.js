const {sign, verify, pack, unpack, signAndPack, unpackAndVerify, signAndPack32, signAndPack45, makeCWT, parseCWT, debug} = require('../lib/index');

test('Verify SE_2DCode_raw_1', async () => {
  const HC1 = 'HC1:NCFOXN%TSMAHN-HVN8J7UQMJ4/3RZLM52YGP1WG2D5X.I5BNUW15:31*GNOLJ78TPL 1C*7JCV4*XUA2PSGH.+H$NI4L6W$Q6VH6ZL4XP:N6ON13.L-$BXTB*ZFBT1OGO6HP.1SH+QL9RLPP1FRM47/97X8D6IAN$36IASD9YHILIIX2M KMKHKYIA$EE%9EUJDZ.CZ/GVNL9KDG+990H-PC5KDZKE.IAHLCV5G%TN.DPYQCXNF*$K8KG+9RR$F+ F.N80N8SN40%KLR2A KZ*U0I1-I0*OC6H0/VMNPM/UESJ0A5L5M0G+SB.V Q5NN9TJ1TM8V34Q3QR$P*NIV1JE0TV9F$DB.E9JMS3JN9NT3ML80P-FH KP8EFVCB%8W5GC894%8WG5O9NTBY4C9W35QBE8F%CD 810H% 0NY0Y 1LA7551DC2U.NVOTJOII:8DKEK%N92T9YQ$0MK%P6$G9K7QQUY9KI.EK*8XRS-DPA5W64SMVR1NF6D0 2S0.7R:ASENTI094PIDS:T3RD7.GG';
  const cwtPayload = await unpackAndVerify(HC1);
  expect(cwtPayload).not.toBe(null);
  expect(cwtPayload).not.toBe(undefined);
  expect(await parseCWT(cwtPayload)).toStrictEqual({'ver': '1.0.0', 'nam': {'fn': 'Lövström', 'fnt': 'LOEVSTROEM', 'gn': 'Oscar', 'gnt': 'OSCAR'}, 'dob': '1958-11-11', 'v': [{'tg': '840539006', 'vp': 'J07BX03', 'mp': 'EU/1/21/1529', 'ma': 'ORG-100030215', 'dn': 2, 'sd': 2, 'dt': '2021-03-18', 'co': 'SE', 'is': 'Swedish eHealth Agency', 'ci': 'urn:uvci:01:SE:EHM/100000024GI5HMGZKSMS'}]});
});

test('Verify SE_2DCode_raw_2', async () => {
  const HC1 = 'HC1:NCFOXN%TSMAHN-HVN8J7UQMJ4/3RZLM52.DNI81IKA6O5+5EFK3-38M4L+XEU70-OLM1GTSDJCBMF6.UCOMIJ6R%E5BD7UJ8+YMHBQ:YM/D7JSPAEQOIR+SPCVOBDSC006XH-$RIY9FZFLVK1SGNSG:PI:IG7Y47%S%*48YIZ73423ZQTW63-E32R4N%2 V0X8LHTC%1DVZK$XKX6TZTCC777ALJW4C-4D-4HRVUMNBLGCK6FNLO$9KZ56DE/.QC$Q7J62:6LZ6DS9++9-G9+E93ZM$96PZ6+Q6X46+E54A9NF625F646F-42*6A3EGUQ4FK.ZJJVFKMSUOCEGNSV8WFPU+8IN9AKPCPP7ZME:MUW6GQ0B-S-*O5W41FDVCB37H5%IL4J-Y3Z1JLZIA9J-3CJYJJZIC0JUPIV SID3VO3H.STTT:ZJ83B+QT$.T$43WVBDKBYLDN4DE1DZLS$FF72P/WPAMNV/VQDU:3HS.IBUB.RS2*M6-P3:E-UH098IPPD7J4Y7$MKW*6*7KDCR3+LP743WLQMD8VH4H4XZ4A8IO6FSS1%UCV50Q/VG1M';
  const cwtPayload = await unpackAndVerify(HC1);
  expect(cwtPayload).not.toBe(null);
  expect(cwtPayload).not.toBe(undefined);
  expect(await parseCWT(cwtPayload)).toStrictEqual({'ver': '1.0.0', 'nam': {'fn': 'Lövström', 'fnt': 'LOEVSTROEM', 'gn': 'Oscar', 'gnt': 'OSCAR'}, 'dob': '1958-11-11', 'v': [{'tg': '840539006', 'vp': 'J07BX03', 'mp': 'EU/1/21/1529', 'ma': 'ORG-100030215', 'dn': 1, 'sd': 2, 'dt': '2021-02-18', 'co': 'SE', 'is': 'Swedish eHealth Agency', 'ci': 'urn:uvci:01:SE:EHM/100000024GI5HMGZKSMS'}, {'tg': '840539006', 'vp': 'J07BX03', 'mp': 'EU/1/21/1529', 'ma': 'ORG-100030215', 'dn': 2, 'sd': 2, 'dt': '2021-04-24', 'co': 'SE', 'is': 'Swedish eHealth Agency', 'ci': 'urn:uvci:01:SE:EHM/100000025KI5PMGZBBM9'}]});
});
